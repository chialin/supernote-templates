# 研究報告：Daily Routine 模板增加參考數字列

**日期：** 2025-10-31
**研究範圍：** [templates/daily-routine.html](../../templates/daily-routine.html) 模板使用性改善
**研究目標：** 在任務追蹤表格中插入重複的數字標頭列，提升手寫打勾時的參考便利性

---

## 執行摘要

本研究針對 Daily Routine 模板的使用性問題進行分析。使用者在手寫打勾至表格中段或底部時，容易因視線距離遠離標頭而無法快速對應任務編號（Task ID）。經過技術分析後，建議在表格的第 15 列之後和第 31 列之後各插入一個參考數字列，使用較淡的視覺樣式以與原始標頭區分。這個解決方案在技術上簡單、維護成本低，且不會破壞現有的響應式設計架構。

**關鍵發現：**
- 表格使用 Flexbox 佈局，所有列高度平均分配（`flex: 1`），插入兩個參考列後會輕微壓縮任務列高度（從 31 列變成 33 列）
- 參考列應使用不同的 CSS class（`reference-header`）以提供視覺區分，避免與真正的 `thead` 混淆
- 需要為參考列設定 `flex: 0 0 auto` 以防止其隨表格拉伸，保持固定高度
- 多裝置支援已內建在 CSS 變數系統中，無需額外調整

---

## 背景與脈絡

Daily Routine 模板是一個為 Supernote e-ink 裝置設計的手寫任務追蹤表格，左側主要區域為一個 31×12 的網格（31 個任務列 × 12 個時間/日期欄位）。使用者在右側的「TASK / KEY」區域寫下任務名稱和編號（1-12），然後在左側表格中對應的位置打勾標記完成狀態。

### 現有架構特點

這個專案採用了**基於 CSS 變數的多裝置響應式設計**，所有裝置共用相同的 HTML 結構，透過 [styles/devices.css](../../styles/devices.css) 中的 media query 自動適配不同尺寸：
- **Nomad (A6 X2)**: 1404×1872px（預設）
- **Manta (A5 X2)**: 1920×2560px

兩款裝置均為 300 DPI，因此字體大小（`--font-size-lg`、`--font-size-md`、`--font-size-sm`）和安全區域（`--safe-area-*`）在實體尺寸上完全相同，只有裝置寬高（`--device-width`、`--device-height`）需要透過 media query 覆蓋。

### 遇到的使用性問題

使用者回報在手寫打勾至表格中段（第 16-30 列）或底部（第 31 列附近）時，由於視線距離頂部的數字標頭過遠，容易忘記當前所在的欄位對應哪個任務編號，需要頻繁上下移動視線確認，影響書寫流暢度。

---

## 研究問題與需求釐清

### 初始需求

使用者希望在以下兩個位置插入重複的任務編號列（1-12）：
1. **第 15 列之後**（作為中段參考點）
2. **第 31 列之後**（作為底部參考點）

### 釐清後的具體要求

透過與使用者確認，明確了以下設計規範：

| 需求面向 | 使用者偏好 | 設計影響 |
|---------|----------|---------|
| **視覺樣式** | 不需要與原始標頭完全相同，能達到參考目的即可 | 使用較淡的顏色或較小的字體，清楚標示這是「參考列」而非「真正標頭」 |
| **列高分配** | 可接受輕微的任務列高度壓縮 | 插入兩個參考列後，總列數從 31 增加至 33，每列高度會略微減少（約 6%） |
| **插入位置** | 第 15 列後、第 31 列後 | 將表格分為三段：1-15、16-31、參考列（底部） |
| **裝置測試** | Nomad 和 Manta 都需要測試 | 必須確保在兩種尺寸下都能正常顯示 |
| **互動性** | 無需任何互動，純視覺參考 | 靜態 HTML，最終轉為 PNG 圖片 |

---

## 技術分析：深入理解問題

### 4.1 程式碼庫現況探索

#### 表格結構分析

目前的 Daily Routine 模板使用了非典型的 table 佈局方式：

```html
<table class="tracker-grid">
    <thead>...</thead>  <!-- 數字標頭：1-12 -->
    <tbody>
        <tr><td class="row-label">1</td><td></td>...</tr>
        <tr><td class="row-label">2</td><td></td>...</tr>
        ...
        <tr><td class="row-label">31</td><td></td>...</tr>
    </tbody>
</table>
```

**CSS 佈局特性：**

```css
.tracker-grid tbody {
    display: flex;
    flex-direction: column;
    flex: 1;  /* 佔滿剩餘空間 */
}

.tracker-grid tr {
    display: flex;
    flex: 1;  /* 每列平均分配高度 */
}

.tracker-grid thead tr {
    flex: 0 0 auto;  /* 標頭固定高度，不參與 flex 分配 */
}
```

**關鍵發現：**
- 使用 `display: flex` 而非傳統的 table 佈局，這讓所有 `<tr>` 會平均分配可用高度
- `thead` 設定為 `flex: 0 0 auto`，因此不會被拉伸
- `tbody` 內的 31 個 `<tr>` 各自佔用 `1/31` 的可用高度

#### 高度計算邏輯

目前的高度分配：
- **裝置高度（Nomad）：** 1872px
- **扣除安全區域：** 1872 - 30（上）- 150（下）= 1692px
- **扣除其他元件：** 標頭（thead）約佔 40px（固定高度）
- **tbody 可用高度：** 約 1650px
- **每個任務列高度：** 1650 ÷ 31 ≈ 53px

**插入兩個參考列後：**
- **總列數：** 31 + 2 = 33
- **每個任務列新高度：** 1650 ÷ 33 ≈ 50px（減少約 6%）

### 4.2 問題根源追蹤

**核心問題：** 如何在保持響應式設計的前提下，插入兩個「看起來像標頭但不是真正 thead」的參考列？

**技術挑戰：**
1. **語義正確性：** 不能在 `tbody` 中插入 `<thead>`（HTML 語法錯誤）
2. **視覺一致性：** 參考列需要看起來像標頭，但又要能視覺區分
3. **響應式支援：** 必須在 Nomad 和 Manta 兩種尺寸下都能正常顯示
4. **Flexbox 行為：** 需要確保參考列不會被過度拉伸或壓縮

**解決方向：**
- 在 `<tbody>` 內使用特殊的 `<tr>` 作為參考列
- 為參考列創建專屬的 CSS class（`reference-header`）
- 使用 `flex: 0 0 auto` 設定固定高度，避免隨表格拉伸

### 4.3 業界智慧與最佳實踐

手寫表格的設計最佳實踐中，常見的改善參考性的方法包括：

1. **重複標頭（Repeated Headers）**
   - **應用場景：** 長表格中每隔一定行數重複顯示欄位名稱
   - **範例：** 紙本問卷、手寫出勤表
   - **適用性：** 正是我們面臨的情況

2. **視覺層級區分**
   - **原則：** 參考用的重複標頭應使用較淡的顏色或較小的字體
   - **目的：** 避免與主要標頭混淆，保持視覺清晰度
   - **實作建議：** 使用灰色（`#666`）或較小的字重（`font-weight: 500`）

3. **固定高度策略**
   - **業界做法：** 在 Flexbox 佈局中，參考列應設定 `flex: 0 0 auto` 或明確的高度值
   - **原因：** 防止參考列被拉伸，保持與主標頭一致的視覺密度

---

## 解決方案探索與評估

### 方案 A：在 tbody 內插入樣式化的參考列（推薦）

**核心理念：**
在 `<tbody>` 內的適當位置（第 15 列後、第 31 列後）插入特殊的 `<tr>`，使用 CSS class `reference-header` 來模擬標頭樣式，但使用較淡的視覺設計以示區分。

**實作步驟：**

1. **HTML 結構變更**

在第 15 列（line 371）之後插入：
```html
<!-- 參考數字列 #1 (第 15 列後) -->
<tr class="reference-header">
    <td></td>
    <td>1</td><td>2</td><td>3</td><td>4</td><td>5</td><td>6</td>
    <td>7</td><td>8</td><td>9</td><td>10</td><td>11</td><td>12</td>
</tr>
```

在第 31 列（line 435）之後插入：
```html
<!-- 參考數字列 #2 (第 31 列後) -->
<tr class="reference-header">
    <td></td>
    <td>1</td><td>2</td><td>3</td><td>4</td><td>5</td><td>6</td>
    <td>7</td><td>8</td><td>9</td><td>10</td><td>11</td><td>12</td>
</tr>
```

2. **CSS 樣式新增**

```css
/* 參考數字列樣式 */
.tracker-grid tr.reference-header {
    flex: 0 0 auto;  /* 固定高度，不參與 flex 分配 */
    background-color: #f5f5f5;  /* 淺灰背景以示區分 */
}

.tracker-grid tr.reference-header td {
    font-weight: 600;  /* 稍微加粗，但比 thead 的 bold 輕 */
    color: #666;  /* 灰色文字，比黑色淡 */
    padding: 4px;
}
```

**評估：**

| 評估面向 | 評分 | 說明 |
|---------|------|------|
| **實作複雜度** | ⭐⭐⭐⭐⭐ | 非常簡單，只需插入兩個 `<tr>` 並新增少量 CSS |
| **維護影響** | ⭐⭐⭐⭐⭐ | 無需修改現有程式碼邏輯，CSS 變數系統繼續生效 |
| **視覺效果** | ⭐⭐⭐⭐⭐ | 清楚區分參考列與主標頭，同時保持一致性 |
| **響應式支援** | ⭐⭐⭐⭐⭐ | 完全相容現有的 media query 系統 |
| **風險等級** | 極低 | 不影響任何現有功能或佈局 |

### 方案 B：複製 thead 結構（不推薦）

**核心理念：**
在 `<tbody>` 內完整複製 `<thead>` 的 HTML 結構和 `th` 元素。

**缺點：**
- ❌ **語義錯誤：** `<th>` 不應出現在 `<tbody>` 內
- ❌ **樣式衝突：** 現有的 `.tracker-grid thead tr` CSS 規則無法套用到 `tbody` 內的列
- ❌ **視覺混淆：** 與真正的標頭完全相同，使用者可能誤認為是表格的開頭

### 方案 C：使用 JavaScript 動態插入（過度設計）

**核心理念：**
透過 JavaScript 在頁面載入時動態插入參考列。

**缺點：**
- ❌ **複雜度過高：** 靜態內容不需要動態生成
- ❌ **維護成本：** 增加程式碼複雜度，未來修改時需要同時調整 HTML 和 JS
- ❌ **不符合專案架構：** 本專案強調純 CSS + HTML 的響應式設計

---

## 建議與決策指引

**推薦方案：方案 A（在 tbody 內插入樣式化的參考列）**

基於以下考量，這是最適合的解決方案：

1. **簡單直接：** 只需在 HTML 中插入兩個 `<tr>` 並新增一個 CSS class
2. **視覺清晰：** 透過顏色和字重區分，使用者能清楚識別參考列
3. **技術穩健：** 完全相容現有的 Flexbox 佈局和 CSS 變數系統
4. **零風險：** 不修改任何現有程式碼，僅為新增內容

### 實施指引

**立即行動：**
1. 在 [templates/daily-routine.html](../../templates/daily-routine.html) 的第 371 行（第 15 列後）插入第一個參考列
2. 在第 435 行（第 31 列後）插入第二個參考列
3. 在 `<style>` 區塊中新增 `.reference-header` 的 CSS 規則

**中期規劃：**
1. 執行 `npm run generate` 生成兩種裝置尺寸的 PNG 檔案
2. 在 Nomad 和 Manta 的實際裝置上測試顯示效果
3. 根據視覺效果微調顏色（`#666`）和背景（`#f5f5f5`）

**風險監控：**
- 檢查參考列是否與任務列高度一致（應該略低或相同）
- 確認在 Manta 尺寸下，文字不會過小或過大
- 驗證 Flexbox 佈局沒有因新增列而崩潰

---

## 下一步行動計畫

這個改善需求屬於**簡單的 UI 優化**，可以直接進行實作，無需撰寫完整的 PRD。

### 立即行動

1. **修改 HTML 檔案**
   - 在指定位置插入兩個參考列
   - 新增必要的 CSS 樣式

2. **測試與驗證**
   - 執行 `npm run generate:nomad` 和 `npm run generate:manta`
   - 檢查生成的 PNG 檔案視覺效果
   - 確認列高分配和視覺層級符合預期

3. **視覺微調（如需要）**
   - 調整參考列的顏色、字重或背景
   - 確保在 e-ink 裝置上的可讀性

### 預期成果

完成實作後，使用者將能在以下位置看到任務編號參考列：
- **位置 1：** 第 15 列與第 16 列之間
- **位置 2：** 第 31 列之後（表格底部）

每個參考列會顯示淺灰色的 1-12 數字，讓使用者在手寫打勾至表格中下段時，無需上下移動視線即可快速確認任務編號。

---

## 參考資料

### 相關程式碼檔案
- [templates/daily-routine.html](../../templates/daily-routine.html) - 需要修改的模板檔案
- [styles/devices.css](../../styles/devices.css) - CSS 變數定義和 media query
- [scripts/convert-to-png.js](../../scripts/convert-to-png.js) - PNG 轉換腳本（無需修改）

### 實作範例
- 專案現有的 `thead` 樣式（line 132-146）可作為參考基礎
- Flexbox 佈局模式已在 `.tracker-grid` 中完整實作（line 101-146）

### 延伸閱讀
- **CSS Flexbox 固定尺寸項目：** 使用 `flex: 0 0 auto` 防止元素拉伸
- **手寫表格設計最佳實踐：** 重複標頭提升長表格可讀性
- **e-ink 裝置視覺設計：** 灰階層級區分的重要性

---

## 結語

這個使用性改善需求明確且技術實作簡單。透過在表格中插入兩個視覺層級較淡的參考數字列，能有效提升使用者手寫打勾時的便利性，特別是在處理表格中下段任務時。建議的實作方案完全相容現有的響應式架構，無需額外的技術調整或重構。

**建議直接進行實作，無需撰寫 PRD。**
